<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Header Design</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    .header {
      background-color: #1a2a44;
      color: #fff;
      padding: 10px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .header .contact {
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      color: #a3bffa;
    }
    .header .search-bar {
      flex-grow: 1;
      margin: 0 20px;
      display: flex;
      justify-content: center;
    }
    .header .search-bar input {
      width: 350px;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px 0 0 4px;
      outline: none;
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
    }
    .header .search-bar button {
      padding: 8px 15px;
      background-color: #f4a261;
      border: none;
      color: #fff;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      transition: background-color 0.3s;
      font-family: 'Roboto', sans-serif;
      font-weight: 500;
    }
    .header .search-bar button:hover {
      background-color: #e07a5f;
    }
    .header .buttons button {
      padding: 8px 20px;
      margin-left: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-family: 'Lora', serif;
      font-size: 14px;
      font-weight: 700;
    }
    .header .buttons .register {
      background-color: #f4a261;
      color: #fff;
    }
    .header .buttons .register:hover {
      background-color: #e07a5f;
    }
    .header .buttons .login {
      background-color: #2a9d8f;
      color: #fff;
    }
    .header .buttons .login:hover {
      background-color: #218c81;
    }
    .header .logo img {
      height: 40px;
    }
    .nav {
      background-color: #fff;
      padding: 10px 30px;
      display: flex;
      align-items: center;
      box-shadow: 0 -1px 4px rgba(0, 0, 0, 0.1);
    }
    .nav .logo {
      flex-shrink: 0;
    }
    .nav .nav-links {
      display: flex;
      gap: 25px;
      flex-grow: 1;
      justify-content: center;
    }
    .nav .nav-links a {
      color: #1a2a44;
      text-decoration: none;
      font-family: 'Lora', serif;
      font-size: 15px;
      font-weight: 400;
      transition: color 0.3s;
    }
    .nav .nav-links a:hover {
      color: #f4a261;
      text-decoration: none;
    }
    .active {
        color: #f4a261 !important;
        text-decoration: none;
    }
    .logo img {
      width: 70px;
      margin-left: 30px;
    }
    .site-footer {
      background-color: #1a2a44;
      color: #fff;
      font-family: 'Roboto', sans-serif;
      box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
    }
    .footer-main {
      background-image: url('https://iigvietnam.com/wp-content/themes/main/assets/images/common/footer-bg.png');
      background-size: cover;
      background-position: center;
      padding: 30px 0;
    }
    .footer-main ._top .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 30px;
    }
    .footer-main .content_common.row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-between;
    }
    .footer-main .col-4,
    .footer-main .col-3,
    .footer-main .col-2 {
      flex: 1;
      min-width: 220px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .footer-main .col-4 {
      flex: 1.5;
    }
    .footer-main .col-3 {
      flex: 1;
    }
    .footer-main .col-2 {
      flex: 0.8;
      align-items: center;
      justify-content: center;
    }
    .footer-main ._label {
      display: flex;
      align-items: center;
      font-family: 'Lora', serif;
      font-size: 15px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 15px;
      text-transform: uppercase;
    }
    .footer-main ._label svg {
      margin-right: 10px;
      flex-shrink: 0;
    }
    .footer-main ._title {
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: #f4a261;
      margin-bottom: 8px;
      text-transform: uppercase;
    }
    .footer-main ._content p,
    .footer-main ._content a {
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      line-height: 1.6;
      color: #a3bffa;
      margin-bottom: 10px;
      text-decoration: none;
    }
    .footer-main ._content a:hover {
      color: #f4a261;
      text-decoration: underline;
    }
    .footer-main .col-2 img {
      max-width: 120px;
      height: auto;
    }
    .footer-main ._bottom {
      text-align: center;
      padding: 15px 0;
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      color: #a3bffa;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 20px;
    }
    .footer-main ._bottom a {
      color: #a3bffa;
      text-decoration: none;
    }
    .footer-main ._bottom a:hover {
      color: #f4a261;
      text-decoration: underline;
    }
    @media (max-width: 768px) {
      .footer-main .col-4,
      .footer-main .col-3,
      .footer-main .col-2 {
        flex: 100%;
        min-width: 100%;
        align-items: center;
        text-align: center;
      }
      .footer-main ._label {
        justify-content: center;
      }
      .footer-main .col-2 {
        order: -1;
      }
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <header class="header">
    <div class="contact">☎ 1900 636 929</div>
    <div class="search-bar">
      
    </div>
    <div class="buttons">
      <a href="/login.html"><button class="register">Đăng nhập</button></a>
      <a href="/register.html"><button class="login">Đăng ký</button></a>
      
    </div>
  </header>
  <nav class="nav">
    <div class="logo">
      <img src="https://online.iigvietnam.com/media/d3vdcety/logo.png" alt="IG Vietnam Logo">
    </div>
    <div class="nav-links">
      <a href="#" class="active">Đăng ký thi</a>
      <a href="#">Quy định & Hướng dẫn</a>
      <a href="#">Địa điểm thi</a>
      <a href="#">Lịch thi</a>
      <a href="#">Vào thi</a>
      <a href="#">Lịch sử đăng ký</a>

    </div>
  </nav>

  <main>
    <section id="registerExam">
        <div id="listExam"></div>
    </section>
  </main>
  <footer id="site-footer" class="site-footer">
    <div class="footer-main">
      <div class="_top">
        <div class="container">
          <div class="content_common row">
            <div class="col-4">
              <div class="_label">
                <svg width="17" height="17" viewBox="0 0 17 17" fill="none">
                  <path d="M8.49212 0C5.10041 0 2.34106 2.7619 2.34106 6.15672C2.34106 10.3698 7.84566 16.5548 8.08002 16.8161C8.30015 17.0615 8.68449 17.0611 8.90422 16.8161C9.13859 16.5548 14.6432 10.3698 14.6432 6.15672C14.6431 2.7619 11.8838 0 8.49212 0ZM8.49212 9.25434C6.78567 9.25434 5.3974 7.86476 5.3974 6.15672C5.3974 4.44869 6.7857 3.05914 8.49212 3.05914C10.1985 3.05914 11.5868 4.44872 11.5868 6.15676C11.5868 7.86479 10.1985 9.25434 8.49212 9.25434Z" fill="#43A2FF"/>
                </svg>
                Địa chỉ văn phòng
              </div>
              <div class="_content">
                <div style="margin-bottom: 20px;">
                  <p class="_title">TRỤ SỞ CHÍNH</p>
                  <p><a href="https://goo.gl/maps/1KZ3Df1Ef9cdK4AC6" target="_blank">75 Giang Văn Minh, Q. Ba Đình, Hà Nội</a></p>
                </div>
                <div>
                  <p class="_title">ĐỊA ĐIỂM ĐĂNG KÝ THI TẠI HÀ NỘI</p>
                  <p><a href="https://maps.app.goo.gl/ni72yppKNjx534qB7" target="_blank">Đại học Công nghiệp Hà Nội</a></p>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="_label">
                <svg width="17" height="13" viewBox="0 0 17 13" fill="none">
                  <path d="M15.5703 0H0.576416L8.07336 6.48401L15.6551 0.0181659C15.6273 0.00965066 15.599 0.0035835 15.5703 0Z" fill="#43A2FF"/>
                  <path d="M8.4375 7.73573C8.22502 7.91841 7.91932 7.91841 7.70685 7.73573L0 1.06885V11.5045C0 11.839 0.258191 12.1101 0.576698 12.1101H15.5706C15.8891 12.1101 16.1473 11.839 16.1473 11.5045V1.15847L8.4375 7.73573Z" fill="#43A2FF"/>
                </svg>
                Địa chỉ Email
              </div>
              <div class="_content">
                <a href="mailto:info@iigvietnam.edu.vn">info@iigvietnam.edu.vn</a>
              </div>
              <div class="_label" style="margin-top: 20px;">
                <svg width="14" height="13" viewBox="0 0 14 13" fill="none">
                  <path d="M13.6861 10.2824L11.5241 8.26995C11.0934 7.87077 10.3803 7.8829 9.93461 8.2978L8.84534 9.31133C8.77653 9.27603 8.70529 9.23916 8.6304 9.20004C7.94254 8.84533 7.00109 8.35915 6.0104 7.43648C5.01678 6.51185 4.49391 5.63431 4.11161 4.99373C4.07127 4.92586 4.03262 4.86043 3.99445 4.79829L4.7255 4.11893L5.08492 3.78401C5.53125 3.36851 5.54356 2.70498 5.11392 2.30464L2.95184 0.291991C2.52219 -0.107791 1.80871 -0.0956627 1.36238 0.319841L0.753032 0.890203L0.769684 0.905588C0.565361 1.14823 0.394623 1.42807 0.267564 1.72986C0.150441 2.01712 0.0775199 2.29123 0.0441767 2.56592C-0.241312 4.76861 0.840232 6.7817 3.7754 9.51343C7.8327 13.2892 11.1023 13.004 11.2434 12.99C11.5506 12.9559 11.845 12.8875 12.1442 12.7794C12.4657 12.6625 12.7662 12.5039 13.0267 12.3141L13.04 12.3251L13.6573 11.7625C14.1028 11.3471 14.1156 10.6834 13.6861 10.2824Z" fill="#43A2FF"/>
                </svg>
                Liên hệ với chúng tôi qua
              </div>
              <div class="_content">
                <p class="_title">Hotline:</p>
                <p><a href="javascript:void(0)" class="_phone">1900 636 929</a></p>
              </div>
            </div>
            <div class="col-4">
              <div class="_label">
                Thời gian làm việc
              </div>
              <div class="_content">
                <p style="margin-bottom: 20px;">
                  <strong class="_title">Sáng: 08:00 - 12:00</strong><br>
                  (Thứ Hai - thứ Bảy)
                </p>
                <p>
                  <strong class="_title">Chiều: 13:30 - 17:30</strong><br>
                  (Thứ Hai - Thứ Sáu)
                </p>
              </div>
            </div>
            <!-- <div class="col-2">
              <img data-src="https://iigvietnam.com/wp-content/themes/main/assets/images/common/logo_update.svg" class="lazyload" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="IIG Vietnam Logo">
            </div> -->
          </div>
        </div>
      </div>
      <div class="_bottom">
        Copyright by IIG Vietnam 2025. All rights reserved.<br>
        <span>Designed and Developed by <a target="_blank" href="#">Twinger</a></span>
      </div>
    </div>
  </footer>

  <script type="module">
    
import {checkAuthorize, getApi} from '/assets/js/library.js'


function formatDate(input) {
  const parts = input.split('-'); // ['0001', '01', '01']
  const year = parts[0];
  const month = parts[1];
  const day = parts[2];

  return `${day}-${month}-${year}`; // '01-01-0001'
}
 $(document).ready(function() {
  //checkAuthorize()
  
  // Sample exam data (for fallback if API fails)
  var exams = [
    // { id: 1, name: "TOEIC Listening & Reading", startDate: "2025-06-10", registDate: "2025-06-03", status: "Open" },
    // { id: 2, name: "TOEFL iBT", startDate: "2025-06-15", registDate: "2025-06-08", status: "Open" },
    // { id: 3, name: "IELTS Academic", startDate: "2025-06-20", registDate: "2025-06-13", status: "Open" },
    // { id: 4, name: "TOEIC Speaking & Writing", startDate: "2025-06-25", registDate: "2025-06-18", status: "Closed" },
  ];

  // Flag to control button visibility (modify as needed)

  // Fetch exams from API
  $.ajax({
    url: `https://localhost:7001/api/exam`,
    type: 'GET',
    xhrFields: {
      withCredentials: true
    },
    success: function(response) {
      console.log(response);
      exams = response; // Assign API response to exams
      renderExamList(); // Render the list after data is fetched
    },
    error: function(error) {
      console.log('Error fetching exams:', error.responseText);
      renderExamList(); // Render with fallback data (empty in this case)
    }
  });

  // Function to format date from YYYY-MM-DD to DD-MM-YYYY
  function formatDate(input) {
    const parts = input.split('-'); // ['YYYY', 'MM', 'DD']
    const year = parts[0];
    const month = parts[1];
    const day = parts[2];
    return `${day}-${month}-${year}`; // 'DD-MM-YYYY'
  }

  // Function to render exam list
  function renderExamList() {
    const $listExam = $('#listExam');
    $listExam.empty(); // Clear existing content

    // Create container for the list
    const $examContainer = $('<div>').css({
      'max-width': '1200px',
      'margin': '30px auto',
      'padding': '0 30px',
      'font-family': '"Roboto", sans-serif'
    });

    // Create heading
    const $heading = $('<h2>').text('Danh Sách Kỳ Thi').css({
      'color': '#1a2a44',
      'font-family': '"Lora", serif',
      'font-weight': '700',
      'font-size': '24px',
      'margin-bottom': '20px',
      'text-align': 'center'
    });
    $examContainer.append($heading);

    // Create table for exams
    const $table = $('<table>').css({
      'width': '100%',
      'border-collapse': 'collapse',
      'background-color': '#fff',
      'box-shadow': '0 2px 4px rgba(0, 0, 0, 0.1)'
    });

    // Table header
    const $thead = $('<thead>').css({
      'background-color': '#1a2a44',
      'color': '#fff'
    });
    const $headerRow = $('<tr>');
    const headers = ['Tên Kỳ Thi', 'Ngày Thi', 'Ngày Mở Đăng Ký', 'Ngày Kết Thúc Đăng Ký', 'Hành Động'];
    headers.forEach(header => {
      const $th = $('<th>').text(header).css({
        'padding': '12px',
        'font-family': '"Lora", serif',
        'font-size': '15px',
        'font-weight': '700',
        'text-align': 'left'
      });
      $headerRow.append($th);
    });
    $thead.append($headerRow);
    $table.append($thead);

    // Table body
    const $tbody = $('<tbody>');
    const currentDate = new Date(); // Current date for comparison

    exams.forEach(async function(exam) {
      const $row = $('<tr>').css({
        'border-bottom': '1px solid #e0e0e0'
      });

      // Exam name
      const $nameCell = $('<td>').text(exam.name).css({
        'padding': '12px',
        'font-family': '"Roboto", sans-serif',
        'font-size': '14px',
        'color': '#1a2a44'
      });

      // Exam date
      const $dateCell = $('<td>').text(formatDate(exam.startDate)).css({
        'padding': '12px',
        'font-family': '"Roboto", sans-serif',
        'font-size': '14px',
        'color': '#1a2a44'
      });

      // Registration start date
      const $registDateCell = $('<td>').text(formatDate(exam.registDate)).css({
        'padding': '12px',
        'font-family': '"Roboto", sans-serif',
        'font-size': '14px',
        'color': '#1a2a44'
      });

      // Registration end date (registDate + 7 days)
      let $endRegistDateCell;
      let endRegistDate;
      try {
        const registDateObj = new Date(exam.registDate);
        if (isNaN(registDateObj)) throw new Error('Invalid date');
        endRegistDate = new Date(registDateObj);
        endRegistDate.setDate(registDateObj.getDate() + 7);
        // Format as DD-MM-YYYY
        const formattedEndDate = endRegistDate.toLocaleDateString('en-GB', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        }).split('/').join('-');
        $endRegistDateCell = $('<td>').text(formattedEndDate).css({
          'padding': '12px',
          'font-family': '"Roboto", sans-serif',
          'font-size': '14px',
          'color': '#1a2a44'
        });
      } catch (e) {
        console.error(`Error parsing date for exam ${exam.name}:`, e);
        $endRegistDateCell = $('<td>').text('N/A').css({
          'padding': '12px',
          'font-family': '"Roboto", sans-serif',
          'font-size': '14px',
          'color': '#e07a5f'
        });
      }

      // Action button
      const $actionCell = $('<td>').css({
        'padding': '12px'
      });

      // Check if registration is still open and if a is true
      const isRegistrationOpen = endRegistDate && endRegistDate >= currentDate;
      

      var isRegist = false;
      if(await checkAuthorize()) {
        isRegist = await getApi('examinee/is-regist', exam.id)
      }
      const showButton = isRegistrationOpen && !isRegist;
      if (showButton) {
        const $registerButton = $(`<button class="btn-regist-exam" data-exam-id="${exam.id}">`).text('Đăng Ký').css({
          'padding': '8px 15px',
          'background-color': '#f4a261',
          'border': 'none',
          'border-radius': '4px',
          'color': '#fff',
          'font-family': '"Lora", serif',
          'font-size': '14px',
          'font-weight': '700',
          'cursor': 'pointer',
          'transition': 'background-color 0.3s'
          
        });

        $registerButton.hover(
          function() { $(this).css('background-color', '#e07a5f'); },
          function() { $(this).css('background-color', '#f4a261'); }
        );
        $registerButton.on('click', async function() {
          // alert(`Đăng ký kỳ thi: ${exam.name} vào ngày ${exam.startDate}`);
          var check = await checkAuthorize()
          console.log('545', check)
          if(check) {
            var examId = $(this).data('exam-id')
            localStorage.setItem('examId', examId)
            var checkInforFull = await getApi('user/check-infor')
            if(checkInforFull) {
              window.location.href = "user-infor-confirm.html";
            } else {
              window.location.href = "user-infor-add.html";
            }
            
          } else {
            window.location.href = "/login.html";
          }
          
        });
        $actionCell.append($registerButton);
      } else {
        // Optionally, display a message or leave the cell empty
        $actionCell.text(''); // Empty cell if button is hidden
      }

      // Append all cells to the row
      $row.append($nameCell, $dateCell, $registDateCell, $endRegistDateCell, $actionCell);
      $tbody.append($row);
    });

    $table.append($tbody);
    $examContainer.append($table);
    $listExam.append($examContainer);
  }
});
</script>
</body>
</html>